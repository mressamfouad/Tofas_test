<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Essam Fouad Exam System - Shuffled V21</title>
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap');

        :root {
            --header-bg: #0b2447;
            --bg-color: #f0f2f5;
            --teal-btn: #4db6ac;
            --blue-selected: #1976d2;
            --text-color: #333;
            --header-height: 60px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            min-height: 100vh;
            overflow-y: auto; 
            padding-top: var(--header-height);
        }

        /* --- ุงูุดุฑูุท ุงูุนููู --- */
        .top-bar {
            height: var(--header-height);
            background-color: var(--header-bg);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 14px;
            position: fixed;
            top: 0; left: 0; width: 100%;
            z-index: 1000;
        }

        .bar-right, .bar-left { display: flex; align-items: center; gap: 10px; }
        .bar-center { display: flex; justify-content: center; flex: 1; }
        
        .menu-btn {
            background: none; border: none; color: white; font-size: 1.2rem;
            cursor: pointer; display: flex; align-items: center; gap: 5px;
            font-family: 'Cairo', sans-serif;
            transition: 0.2s;
        }
        .menu-btn:hover { color: var(--teal-btn); }

        .menu-link {
            text-decoration: none; color: white; font-size: 1.2rem; 
            display: flex; align-items: center; gap: 5px; font-family: 'Cairo', sans-serif;
            transition: 0.2s;
        }
        .menu-link:hover { color: var(--teal-btn); }

        .info-pill {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 15px; border-radius: 4px; display: flex;
            align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.2);
        }

        .btn {
            border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer;
            font-family: 'Cairo', sans-serif; font-weight: 600; transition: 0.2s;
        }
        .btn-finish { background-color: var(--teal-btn); color: #004d40; }
        .btn-finish:hover { opacity: 0.9; }
        .btn-next { background-color: #e0e0e0; color: #333; }
        .btn-next:hover { background-color: #d5d5d5; }
        .btn-back { background-color: transparent; color: #aaa; border: 1px solid #555; }
        .btn-back:hover { color: white; border-color: white; }

        /* --- ุญุงููุฉ ุงูุงุฎุชุจุงุฑ --- */
        .exam-container {
            display: flex;
            align-items: flex-start;
            width: 100%;
            min-height: calc(100vh - var(--header-height));
        }

        .question-panel {
            width: 45%; 
            background: #fff; 
            padding: 30px;
            border-left: 1px solid #ddd; 
            position: sticky;
            top: var(--header-height);
            height: calc(100vh - var(--header-height));
            overflow-y: auto;
        }

        .q-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .q-title { font-size: 1.3rem; color: #666; font-weight: bold; }
        .explain-btn {
            background: #fff; border: 1px solid #ccc; padding: 5px 12px;
            border-radius: 4px; color: #666; cursor: pointer; font-size: 0.9rem;
            font-family: 'Cairo', sans-serif;
        }
        .q-text { font-size: 1.2rem; margin-bottom: 25px; color: #444; line-height: 1.6; }

        .output-box {
            background-color: #f8f9fa; border: 1px solid #ddd; padding: 20px;
            border-radius: 6px; min-height: 80px; display: flex;
            align-items: center; font-family: 'Cairo', sans-serif;
            font-weight: bold; font-size: 1.1rem; color: #333;
            position: relative; white-space: pre-wrap;
            direction: ltr; text-align: right;
        }

        .options-panel {
            width: 55%; 
            background-color: #dbe0e6; 
            padding: 20px;
            display: flex; 
            flex-direction: column; 
            gap: 15px;
            min-height: calc(100vh - var(--header-height));
        }

        .option-card {
            background: white;
            border-radius: 8px;
            display: flex;
            min-height: 80px; 
            height: auto;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 2px solid transparent;
        }
        .option-card:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

        .opt-number-strip {
            width: 45px; background-color: #eef1f5; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            border-left: 1px solid #ddd; color: #8898aa; font-weight: bold;
            font-size: 1.2rem; transition: 0.2s; flex-shrink: 0;
            border-top-right-radius: 6px; border-bottom-right-radius: 6px;
        }

        .radio-check {
            width: 24px; height: 24px; border: 2px solid #ccc;
            border-radius: 50%; margin-bottom: 8px; transition: 0.2s;
        }

        .opt-code {
            flex: 1; padding: 15px 20px; display: flex; align-items: center;
            font-family: 'Fira Code', 'Courier New', monospace; direction: ltr; 
            color: #333; font-weight: 700; font-size: 1.1rem;    
            line-height: 1.6; word-break: break-word;
        }
        .opt-code pre { margin: 0; white-space: pre-wrap; }

        .option-card.selected { border-color: var(--blue-selected); }
        .option-card.selected .opt-number-strip {
            background-color: var(--blue-selected); color: white; border-left: none;
        }
        .option-card.selected .radio-check {
            border-color: white; background-color: transparent;
        }
        .option-card.selected .radio-check::after {
            content: ''; width: 12px; height: 12px; background: white;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); z-index: 2000;
            display: none; justify-content: center; align-items: center;
        }

        /* List Modal */
        .question-list-content {
            background-color: #fff; width: 100%; height: 100%; max-width: 350px;
            display: flex; flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.2);
            position: absolute; right: 0; top: 0; 
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        .list-header {
            background-color: var(--header-bg); color: white; padding: 20px; text-align: center; position: relative;
        }
        .close-btn-list {
            position: absolute; top: 20px; left: 20px; background: none; border: none;
            color: white; font-size: 1.0rem; cursor: pointer;
        }
        .list-title { font-size: 0.9rem; margin-bottom: 15px; font-weight: bold; }
        .list-scroll-area { flex: 1; overflow-y: auto; padding: 10px 0; }
        .list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 25px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: background 0.2s;
        }
        .list-item:hover { background-color: #f9f9f9; }
        .item-q-name { font-weight: bold; color: #333; text-decoration: underline; text-decoration-color: #ddd; }
        .item-status { font-size: 0.9rem; font-weight: bold; }
        .status-answered { color: #2e7d32; text-decoration: underline; }
        .status-unanswered { color: #d32f2f; }

        /* Confirm Modal */
        .center-modal {
            background: white; width: 90%; max-width: 500px; border-radius: 12px;
            padding: 30px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            font-family: 'Cairo', sans-serif;
            max-height: 90vh; overflow-y: auto;
        }
        .modal-title { font-weight: bold; font-size: 1.4rem; color: #333; margin-bottom: 20px; }
        .info-box {
            background-color: #e3f2fd; border: 1px solid #bbdefb; color: #0d47a1;
            padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex;
            align-items: center; gap: 10px; font-weight: 600; font-size: 0.95rem; text-align: right;
        }
        .warning-text { color: #d32f2f; font-weight: bold; margin-bottom: 30px; font-size: 0.95rem; }
        .modal-actions { display: flex; justify-content: center; gap: 20px; }
        .btn-modal { padding: 10px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; font-size: 1rem; border: none; }
        .btn-cancel { background: white; border: 1px solid #ccc; color: #555; }
        .btn-cancel:hover { background: #f5f5f5; }
        .btn-confirm { background: #d32f2f; color: white; }
        .btn-confirm:hover { background: #b71c1c; }

        /* Success Modal */
        .success-logo { 
            color: #000080; font-weight: bold; font-size: 2rem; margin-bottom: 10px; letter-spacing: 1px;
        }
        .success-logo span { color: #ff007f; }
        
        .score-display {
            font-size: 1.3rem; color: #333; font-weight: bold; margin: 10px 0 20px 0;
            padding: 10px; background: #f0f7ff; border-radius: 8px; border: 1px solid #cce5ff;
        }

        .wrong-answers-box {
            margin: 15px 0; padding: 15px; background-color: #ffebee;
            border: 1px solid #ffcdd2; color: #c62828; border-radius: 8px;
            font-size: 1rem; line-height: 1.6; text-align: right; display: none;
        }

        .check-circle {
            width: 80px; height: 80px; border-radius: 50%; border: 5px solid #0288d1;
            display: flex; justify-content: center; align-items: center; margin: 20px auto;
        }
        .check-mark {
            width: 25px; height: 45px; border-bottom: 5px solid #0288d1; border-right: 5px solid #0288d1;
            transform: rotate(45deg); margin-bottom: 10px;
        }
        .success-text { color: #555; margin-bottom: 30px; line-height: 1.6; font-size: 0.95rem; }
        .btn-close-success {
            background-color: #0288d1; color: white; width: 100%; padding: 12px;
            border-radius: 30px; font-size: 1.1rem; border: none; cursor: pointer; font-weight: bold;
        }
        .btn-close-success:hover { background-color: #0277bd; }

        .end-exam-btn-large {
            background-color: #64ffda; color: #0b2447; border: none;
            padding: 10px 50px; border-radius: 25px; font-size: 1rem;
            font-weight: bold; cursor: pointer; display: inline-block;
            font-family: 'Cairo', sans-serif; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .end-exam-btn-large:hover { background-color: #52e0c0; }

        @media (max-width: 900px) {
            /* 1. ุชุฑุชูุจ ุงูุฃุนูุฏุฉ (ุณุจู ูุฌูุฏู) */
            .exam-container { flex-direction: column; }
            .question-panel { 
                width: 100%; height: auto; position: relative; top: 0;
                border-left: none; border-bottom: 1px solid #ddd; 
            }
            .options-panel { width: 100%; min-height: auto; }
            .question-list-content { max-width: 100%; position: fixed; }

            /* --- 2. ุฅุตูุงุญุงุช ุงูุดุฑูุท ุงูุนููู ููููุจุงูู --- */
            
            /* ุชูููู ุงูุญูุงุด ุงูุฏุงุฎููุฉ ููุดุฑูุท */
            .top-bar { padding: 0 5px; }

            /* ุฅุฎูุงุก ุฑุงุจุท "ุชุตููู ูุณุชุฑ ุนุตุงู" ูุชูููุฑ ูุณุงุญุฉ */
            .menu-link { display: none; }

            /* ุฅุฎูุงุก ูุต "ูุงุฆูุฉ ุงูุฃุณุฆูุฉ" ูุงูุฅุจูุงุก ุนูู ุงูุฃููููุฉ ููุท */
            .menu-btn span:nth-child(2) { display: none; }

            /* ุชุตุบูุฑ ุงููุณุงูุงุช ุจูู ุงูุนูุงุตุฑ ูู ุงูููุชุตู */
            .bar-center > div { gap: 4px !important; }

            /* ุชุตุบูุฑ ุญุฌู ุงูุฃุฒุฑุงุฑ ูุงููุตูุต */
            .btn {
                padding: 4px 10px;
                font-size: 0.8rem; /* ุฎุท ุฃุตุบุฑ */
                border-radius: 15px;
            }

            /* ุชุตุบูุฑ ุญุฌู ุงูุนุฏุงุฏ ูุงูููุช */
            .info-pill {
                padding: 3px 8px;
                font-size: 0.75rem;
                gap: 4px;
            }

            /* ุฒุฑ ุฅููุงุก ุงูุงุฎุชุจุงุฑ */
            .btn-finish {
                padding: 4px 8px;
                font-size: 0.75rem;
            }
            
            /* ุฅุฎูุงุก ูููุฉ "ุงูุณุคุงู" ู "ูุชุจูู" ููุฅุจูุงุก ุนูู ุงูุฃุฑูุงู ููุท ุฅุฐุง ูุฒู ุงูุฃูุฑ */
            .info-pill span:nth-child(2) { display: none; }
        }
    </style>
</head>
<body>

    <header class="top-bar">
        <div class="bar-right">
            <button class="menu-btn" onclick="toggleQuestionList()"><span>โฐ</span><span style="margin-right:5px"> ูุงุฆูุฉ ุงูุฃุณุฆูุฉ </span></button>
        </div>
        <div class="bar-center">
            <div style="display:flex; gap:10px;">
                <a class="menu-link" href="https://youtu.be/KOXHB0epeTs" target="_blank">ุชุตููู ูุณุชุฑ ุนุตุงู ูุคุงุฏ</a> &nbsp;&nbsp;&nbsp;&nbsp;
                <button class="btn btn-back" id="btn-prev" onclick="prevQuestion()" disabled>ุฑุฌูุน</button>
                <div class="info-pill"><span id="q-counter">1 / 20</span><span>๐ ุงูุณุคุงู</span></div>
                <div class="info-pill"><span id="timer">40:00</span><span>โฑ ูุชุจูู</span></div>
                <button class="btn btn-next" id="btn-next" onclick="nextQuestion()">ุงูุชุงูู</button> 
            </div>
        </div>
        <div class="bar-left">
            <button class="btn btn-finish" onclick="showConfirmModal()">ุฅููุงุก ุงูุงุฎุชุจุงุฑ</button>
        </div>
    </header>

    <div class="exam-container">
        <div class="question-panel">
            <div class="q-header-row">
                <span class="q-title" id="q-title">ุงูุณุคุงู 1</span>
                <button class="explain-btn" onclick="window.open('https://youtu.be/KOXHB0epeTs', '_blank')">ุนุฑุถ ุดุฑุญ ุงูููุฏ</button>
            </div>
            <p class="q-text" id="q-text">...</p>
            <div class="output-box" id="q-output">...</div>
        </div>

        <div class="options-panel" id="options-container"></div>
    </div>

    <div class="modal-overlay" id="questionListModal" style="justify-content: flex-start;">
        <div class="question-list-content">
            <div class="list-header">
                <button class="close-btn-list" onclick="toggleQuestionList()">โ ูุบูู</button>
                <div class="list-title">TOFAS <br> (ุงููุณุชูู ุงูุฃูู ูู ุจุฑูุฌุฉ ุฌุงูุง ุณูุฑุจุช)</div>
                <button class="end-exam-btn-large" onclick="showConfirmModal()">ููุงูุฉ ุงูุงุฎุชุจุงุฑ</button>
            </div>
            <div class="list-scroll-area" id="listItemsContainer"></div>
        </div>
    </div>

    <div class="modal-overlay" id="confirmModal">
        <div class="center-modal">
            <h3 class="modal-title">ูู ุชุฑูุฏ ุฅููุงุก ุงูุงุฎุชุจุงุฑุ</h3>
            <div class="info-box">
                <span style="font-size:1.5rem; color:#0288d1">โ</span>
                ูุฑุฌู ูุฑุงุฌุนุฉ ุฅุฌุงุจุงุชู ูุจู ุฅููุงุก ุงูุงุฎุชุจุงุฑ.
            </div>
            <p class="warning-text">ุจูุฌุฑุฏ ุฅููุงุก ุงูุงุฎุชุจุงุฑุ ูุง ูููู ุงูุจุฏุก ูุฑุฉ ุฃุฎุฑู.</p>
            <div class="modal-actions">
                <button class="btn-modal btn-cancel" onclick="closeConfirmModal()">ุฑุฌูุน</button>
                <button class="btn-modal btn-confirm" onclick="finalizeExam()">ุฅููุงุก ุงูุงุฎุชุจุงุฑ</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="successModal">
        <div class="center-modal" style="padding: 40px 30px;">
            <div class="success-logo">Essam <span>Fouad</span></div>
            
            <div id="finalScoreDisplay" class="score-display" style="display:none;"></div>
            
            <div id="wrongQuestionsDisplay" class="wrong-answers-box"></div>

            <h3 style="margin: 10px 0; color: #333;">ููุฏ ุชู ุฅุฑุณุงู ูุชุงุฆุฌู.</h3>
            <div class="check-circle"><div class="check-mark"></div></div>
            <div class="success-text">
                <p style="font-weight: bold; margin-bottom:10px;">ููุฏ ุชู ุงุณุชูุงู ุฅุฌุงุจุงุชู.</p>
                <p>ุจูุฌุฑุฏ ุงูุงูุชูุงุกุ ูุฑุฌู ุงุชุจุงุน ููุงุนุฏ ุงูููุงู ุงูุฐู ุณุชุฌุฑู ููู ุงูุงุฎุชุจุงุฑ.<br>
                ุฅุฐุง ููุช ูุง ุชุนุฑู ูุงุฐุง ุชูุนูุ ูุฑุฌู ุฃู ุชุณุฃู ุงูููุณุฑ ุงูุฎุงุต ุจู.</p>
            </div>
            <button class="btn-close-success" onclick="closeSuccessModal()">ูุบูู</button>
        </div>
    </div>

    <script>
        function checkSession() {
            if (sessionStorage.getItem("access") !== "ok") {
                window.location.replace("dashboard.html");
            }
        }
        checkSession();

        window.onpageshow = function(event) {
            if (event.persisted) {
                checkSession();
            }
        };
    </script>

    <script>
        // --- ุงูุฃุณุฆูุฉ (20 ุณุคุงู) - ุจุชุฑุชูุจ ุฌุฏูุฏ ุนุดูุงุฆู + ุชุฑุฌูุฉ ุงูุณุคุงู ููุนุฑุจูุฉ ---
        const questions = [
            // Old Q15 -> New Q1
            { id: 1, title: "ุงูุณุคุงู 1", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'Proper size'", targetOutput: "Proper size", options: [{ code: 'let size => 70;\nif (size > 100) {\n  console.log("Proper size");\n} else {\n  console.log("Over size limit");\n}' }, { code: 'let size = 70;\nif (size < 100) {\n  console.log("Proper size");\n} else {\n  console.log("Over size limit");\n}' }, { code: 'let size = 70;\nif (size > 100) {\n  console.log("Proper size");\n} else {\n  console.log("Over size limit");\n}' }, { code: 'let size => 70;\nif (size < 100) {\n  console.log("Proper size");\n} else {\n  console.log("Over size limit");\n}' }], correctAnswer: 1 },
            
            // Old Q5 -> New Q2
            { id: 2, title: "ุงูุณุคุงู 2", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงููุต 'Over capacity'", targetOutput: "Over capacity", options: [{ code: 'let passengers = 12;\nlet additionalPassengers = 4;\nlet capacity = 15;\nelse ((passengers + additionalPassengers) > capacity) {\n  console.log("Over capacity");\n} else {\n  console.log("Starting to move.");\n}' }, { code: 'let passengers = 12;\nlet additionalPassengers = 4;\nlet capacity = 15;\nelse ((passengers / additionalPassengers) > capacity) {\n  console.log("Over capacity");\n} else {\n  console.log("Starting to move.");\n}' }, { code: 'let passengers = 12;\nlet additionalPassengers = 4;\nlet capacity = 15;\nif ((passengers / additionalPassengers) > capacity) {\n  console.log("Over capacity");\n} else {\n  console.log("Starting to move.");\n}' }, { code: 'let passengers = 12;\nlet additionalPassengers = 4;\nlet capacity = 15;\nif ((passengers + additionalPassengers) > capacity) {\n  console.log("Over capacity");\n} else {\n  console.log("Starting to move.");\n}' }], correctAnswer: 3 },

            // Old Q10 -> New Q3
            { id: 3, title: "ุงูุณุคุงู 3", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุชุงูู:\nToday is a holiday.\nLet's play outside.", targetOutput: "Today is a holiday.\nLet's play outside.", options: [{ code: 'let dayOfWeek = "Sunday";\nlet weather = "Cloudy";\nif (dayOfWeek == "Saturday") {\n  console.log("Today is a holiday.");\n} else if (dayOfWeek == "Sunday") {\n  console.log("Today is a holiday.");\n}\nif (weather == "Rainy") {\n  console.log("Let\'s play indoors.");\n} else {\n  console.log("Let\'s play outside.");\n}' }, { code: 'let dayOfWeek = "Sunday";\nlet weather = "Cloudy";\nif (dayOfWeek == "Saturday") {\n  console.log("Today is a holiday.");\n} if else (dayOfWeek == "Sunday") {\n  console.log("Today is a holiday.");\n}\nif (weather == "Rainy") {\n  console.log("Let\'s play indoors.");\n} if {\n  console.log("Let\'s play outside.");\n}' }, { code: 'let dayOfWeek = "Sunday";\nlet weather = "Cloudy";\nif (dayOfWeek == "Saturday") {\n  console.log("Today is a holiday.");\n} if else (dayOfWeek == "Sunday") {\n  console.log("Today is a holiday.");\n}\nif (weather == "Rainy") {\n  console.log("Let\'s play indoors.");\n} else {\n  console.log("Let\'s play outside.");\n}' }, { code: 'let dayOfWeek = "Sunday";\nlet weather = "Cloudy";\nif (dayOfWeek == "Saturday") {\n  console.log("Today is a holiday.");\n} else if (dayOfWeek == "Sunday") {\n  console.log("Today is a holiday.");\n}\nif (weather == "Rainy") {\n  console.log("Let\'s play indoors.");\n} if {\n  console.log("Let\'s play outside.");\n}' }], correctAnswer: 0 },

            // Old Q1 -> New Q4
            { id: 4, title: "ุงูุณุคุงู 4", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุงุชุฌ ุชูููุฐู ูู ุงูุฑูู 3", targetOutput: "3", options: [{ code: 'let num1 = 18;\nlet num2 = 15;\nnum1 / num2;' }, { code: 'let num1 = 18;\nlet num2 = 15;\nconsole.log(num1 / num2);' }, { code: 'let num1 = 18;\nlet num2 = 15;\nnum1 - num2;' }, { code: 'let num1 = 18;\nlet num2 = 15;\nconsole.log(num1 - num2);' }], correctAnswer: 3 },

            // Old Q18 -> New Q5
            { id: 5, title: "ุงูุณุคุงู 5", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุชุงูู:\nYour savings have increased.\n200,000 yen", targetOutput: "Your savings have increased.\n200,000 yen", options: [{ code: 'let savingBalance = "100,000 yen";\nsavingBalance("200,000 yen");\nconsole.log("Your savings have increased.");\nconsole.log(savingBalance);' }, { code: 'let savingBalance = "100,000 yen";\nconsole.log("Your savings have increased.");\nconsole.log(savingBalance);\nsavingBalance("200,000 yen");' }, { code: 'let savingBalance = "100,000 yen";\nconsole.log("Your savings have increased.");\nconsole.log(savingBalance);\nsavingBalance = "200,000 yen";' }, { code: 'let savingBalance = "100,000 yen";\nsavingBalance = "200,000 yen";\nconsole.log("Your savings have increased.");\nconsole.log(savingBalance);' }], correctAnswer: 3 },

            // Old Q2 -> New Q6
            { id: 6, title: "ุงูุณุคุงู 6", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงููุต 'Banana'", targetOutput: "Banana", options: [{ code: 'let fruit > "Banana";\nfruit;' }, { code: 'let fruit > "Banana";\nconsole.log(fruit);' }, { code: 'let fruit = "Banana";\nfruit;' }, { code: 'let fruit = "Banana";\nconsole.log(fruit);' }], correctAnswer: 3 },

            // Old Q12 -> New Q7
            { id: 7, title: "ุงูุณุคุงู 7", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'Please charge.'", targetOutput: "Please charge.", options: [{ code: 'let batteryPower = "Empty";\nif (batteryPower == "Full") {\n  console.log("No need to charge.");\n} if {\n  console.log("Please charge.");\n}' }, { code: 'let batteryPower = "Empty";\nif (batteryPower = "Full") {\n  console.log("No need to charge.");\n} if {\n  console.log("Please charge.");\n}' }, { code: 'let batteryPower = "Empty";\nif (batteryPower == "Full") {\n  console.log("No need to charge.");\n} else {\n  console.log("Please charge.");\n}' }, { code: 'let batteryPower = "Empty";\nif (batteryPower = "Full") {\n  console.log("No need to charge.");\n} else {\n  console.log("Please charge.");\n}' }], correctAnswer: 2 },

            // Old Q8 -> New Q8
            { id: 8, title: "ุงูุณุคุงู 8", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุชุงูู:\nUsing one coupon.\nThe prices are as follows.\n1990", targetOutput: "Using one coupon.\nThe prices are as follows.\n1990", options: [{ code: 'let productPrice = 2000;\nlet couponNum = 1;\nif (couponNum == 2) {\n  console.log("Using two coupons.");\n  productPrice = productPrice - 30;\n} else if {\n  console.log("Using one coupon.");\n  productPrice = productPrice - 10;\n} else {\n  console.log("Not using any coupons.");\n}\nconsole.log("The prices are as follows.");\nconsole.log(productPrice);' }, { code: 'let productPrice = 2000;\nlet couponNum = 1;\nif (couponNum == 2) {\n  console.log("Using two coupons.");\n  productPrice = productPrice - 30;\n} else if (couponNum == 1) {\n  console.log("Using one coupon.");\n  productPrice = productPrice - 10;\n} else {\n  console.log("Not using any coupons.");\n}\nconsole.log("The prices are as follows.");\nconsole.log(productPrice);' }, { code: 'let productPrice = 2000;\nlet couponNum = 1;\nif (couponNum == 2) {\n  console.log("Using two coupons.");\n  productPrice = productPrice - 30;\n} else if (couponNum == 1) {\n  console.log("Using one coupon.");\n  productPrice = productPrice - 10;\n else {\n  console.log("Not using any coupons.");\n}\nconsole.log("The prices are as follows.");\nconsole.log(productPrice);' }, { code: 'let productPrice = 2000;\nlet couponNum = 1;\nif (couponNum == 2) {\n  console.log("Using two coupons.");\n  productPrice = productPrice - 30;\n} else if {\n  console.log("Using one coupon.");\n  productPrice = productPrice - 10;\n} else {\n  console.log("Not using any coupons.");\n}\nconsole.log("The prices are as follows.");\nconsole.log(productPrice);' }], correctAnswer: 1 },

            // Old Q4 -> New Q9
            { id: 9, title: "ุงูุณุคุงู 9", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุงุชุฌ ุชูููุฐู ูู ุงูุฑูู 200", targetOutput: "200", options: [{ code: 'let num = 150;\nnum = 50;\nconsole.log(num);' }, { code: 'let num = 150;\nnum + 50;\nconsole.log(num);' }, { code: 'let num = 150;\nnum = num + 50;\nconsole.log(num);' }, { code: 'let num = 150;\nnum = num - 50;\nconsole.log(num);' }], correctAnswer: 2 },

            // Old Q19 -> New Q10
            { id: 10, title: "ุงูุณุคุงู 10", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'The number of apples and oranges is the same.'", targetOutput: "The number of apples and oranges is the same.", options: [{ code: 'if (appleNum == orangeNum) {\n  console.log("The number of apples and oranges is the same.");\n} else {\n  console.log("The number of apples and oranges is not the same.");\n}\nlet appleNum = 10;\nlet orangeNum = 10;' }, { code: 'let appleNum = 10;\nlet orangeNum = 10;\nif (appleNum > orangeNum) {\n  console.log("The number of apples and oranges is the same.");\n} else {\n  console.log("The number of apples and oranges is not the same.");\n}' }, { code: 'if (appleNum > orangeNum) {\n  console.log("The number of apples and oranges is the same.");\n} else {\n  console.log("The number of apples and oranges is not the same.");\n}\nlet appleNum = 10;\nlet orangeNum = 10;' }, { code: 'let appleNum = 10;\nlet orangeNum = 10;\nif (appleNum == orangeNum) {\n  console.log("The number of apples and oranges is the same.");\n} else {\n  console.log("The number of apples and oranges is not the same.");\n}' }], correctAnswer: 3 },

            // Old Q14 -> New Q11
            { id: 11, title: "ุงูุณุคุงู 11", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุชุงูู:\n1500\nYou don't have enough money.", targetOutput: "1500\nYou don't have enough money.", options: [{ code: 'let orangePrice = 300;\nlet orangeNum = 5;\nlet totalCost = 0;\ntotalCost = orangePrice * orangeNum;\nconsole.log(totalCost);\nif (totalCost < 1000) {\n  console.log("You can buy it.");\n} else {\n  console.log("You don\'t have enough money.");\n}' }, { code: 'let orangePrice = 300;\nlet orangeNum = 5;\nlet totalCost = 0;\ntotalCost = orangePrice * orangeNum;\nconsole.log(totalCost);\nif (totalCost > 1000) {\n  console.log("You can buy it.");\n} else {\n  console.log("You don\'t have enough money.");\n}' }, { code: 'let orangePrice = 300;\nlet orangeNum = 5;\nlet totalCost = 0;\ntotalCost = orangePrice / orangeNum;\nconsole.log(totalCost);\nif (totalCost < 1000) {\n  console.log("You can buy it.");\n} else {\n  console.log("You don\'t have enough money.");\n}' }, { code: 'let orangePrice = 300;\nlet orangeNum = 5;\nlet totalCost = 0;\ntotalCost = orangePrice / orangeNum;\nconsole.log(totalCost);\nif (totalCost > 1000) {\n  console.log("You can buy it.");\n} else {\n  console.log("You don\'t have enough money.");\n}' }], correctAnswer: 0 },

            // Old Q6 -> New Q12
            { id: 12, title: "ุงูุณุคุงู 12", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'My friend is older.'", targetOutput: "My friend is older.", options: [{ code: 'let myAge = 10;\nlet friendAge = 12;\nif (myAge > friendAge) {\n  console.log("I\'m older.");\n else {\n  console.log("My friend is older.");\n}' }, { code: 'let myAge == 10;\nlet friendAge == 12;\nif (myAge > friendAge) {\n  console.log("I\'m older.");\n} else {\n  console.log("My friend is older.");\n}' }, { code: 'let myAge = 10;\nlet friendAge = 12;\nif (myAge > friendAge) {\n  console.log("I\'m older.");\n} else {\n  console.log("My friend is older.");\n}' }, { code: 'let myAge == 10;\nlet friendAge == 12;\nif (myAge > friendAge) {\n  console.log("I\'m older.");\n} else {\n  console.log("My friend is older.");\n}' }], correctAnswer: 2 },

            // Old Q16 -> New Q13
            { id: 13, title: "ุงูุณุคุงู 13", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'Reservations are available.'", targetOutput: "Reservations are available.", options: [{ code: 'let peopleNumLimit = 20;\nlet reservationPeopleNum = 10;\nelse (peopleNumLimit < reservationPeopleNum) {\n  console.log("Reservations are available.");\n} else {\n  console.log("Reservations are not available.");\n}' }, { code: 'let peopleNumLimit = 20;\nlet reservationPeopleNum = 10;\nif (peopleNumLimit > reservationPeopleNum) {\n  console.log("Reservations are available.");\n} else {\n  console.log("Reservations are not available.");\n}' }, { code: 'let peopleNumLimit = 20;\nlet reservationPeopleNum = 10;\nif (peopleNumLimit < reservationPeopleNum) {\n  console.log("Reservations are available.");\n} else {\n  console.log("Reservations are not available.");\n}' }, { code: 'let peopleNumLimit = 20;\nlet reservationPeopleNum = 10;\nelse (peopleNumLimit > reservationPeopleNum) {\n  console.log("Reservations are available.");\n} else {\n  console.log("Reservations are not available.");\n}' }], correctAnswer: 1 },

            // Old Q9 -> New Q14
            { id: 14, title: "ุงูุณุคุงู 14", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'We rent out large meeting rooms.'", targetOutput: "We rent out large meeting rooms.", options: [{ code: 'let peopleNum = 25;\nif (peopleNum < 10) {\n  console.log("We rent out small meeting rooms.");\n} else if (peopleNum < 30) {\n  console.log("We rent out large meeting rooms.");\n} else {\n  console.log("No suitable meeting rooms are available.");\n}' }, { code: 'let peopleNum = 25;\nif else (peopleNum < 10) {\n  console.log("We rent out small meeting rooms.");\n} else (peopleNum < 30) {\n  console.log("We rent out large meeting rooms.");\n} else {\n  console.log("No suitable meeting rooms are available.");\n}' }, { code: 'let peopleNum = 25;\nif else (peopleNum < 10) {\n  console.log("We rent out small meeting rooms.");\n} else if (peopleNum < 30) {\n  console.log("We rent out large meeting rooms.");\n} else {\n  console.log("No suitable meeting rooms are available.");\n}' }, { code: 'let peopleNum = 25;\nif (peopleNum < 10) {\n  console.log("We rent out small meeting rooms.");\n} else (peopleNum < 30) {\n  console.log("We rent out large meeting rooms.");\n} else {\n  console.log("No suitable meeting rooms are available.");\n}' }], correctAnswer: 0 },

            // Old Q3 -> New Q15
            { id: 15, title: "ุงูุณุคุงู 15", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุชุงูู:\nTrain\nBus", targetOutput: "Train\nBus", options: [{ code: 'let vehicle = "Train";\nconsole.log(vehicle);\nvehicle = "Bus";\nconsole.log(vehicle);' }, { code: 'let vehicle = "Train";\nvehicle;\nvehicle < "Bus";\nvehicle;' }, { code: 'let vehicle = "Train";\nconsole.log(vehicle);\nvehicle < "Bus";\nconsole.log(vehicle);' }, { code: 'let vehicle = "Train";\nvehicle;\nvehicle = "Bus";\nvehicle;' }], correctAnswer: 0 },

            // Old Q17 -> New Q16
            { id: 16, title: "ุงูุณุคุงู 16", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'I am going to school.'", targetOutput: "I am going to school.", options: [{ code: 'if (timeZone == 8) {\n  "I am going to school.";\n}\nlet timeZone = 8;' }, { code: 'let timeZone = 8;\nif (timeZone == 8) {\n  "I am going to school.";\n}' }, { code: 'if (timeZone == 8) {\n  console.log("I am going to school.");\n}\nlet timeZone = 8;' }, { code: 'let timeZone = 8;\nif (timeZone == 8) {\n  console.log("I am going to school.");\n}' }], correctAnswer: 3 },

            // Old Q7 -> New Q17
            { id: 17, title: "ุงูุณุคุงู 17", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'Charging is not needed.'", targetOutput: "Charging is not needed.", options: [{ code: 'let battery = 50;\nif (battery < 20) {\n  console.log("Charging is recommended.");\n} else {\n  console.log("Charging is not needed.");\n}' }, { code: 'let battery = 50;\nif {\n  console.log("Charging is recommended.");\n} else {\n  console.log("Charging is not needed.");\n}' }, { code: 'let battery = 50;\nif (battery < 20) {\n  console.log("Charging is recommended.");\n} if {\n  console.log("Charging is not needed.");\n}' }, { code: 'let battery = 50;\nif {\n  console.log("Charging is recommended.");\n} if {\n  console.log("Charging is not needed.");\n}' }], correctAnswer: 0 },

            // Old Q13 -> New Q18
            { id: 18, title: "ุงูุณุคุงู 18", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'That will be 200 yen.'", targetOutput: "That will be 200 yen.", options: [{ code: 'let order = "Orange juice";\nif (order > "Apple juice") {\n  console.log("That will be 250 yen.");\n} else if (order > "Orange juice") {\n  console.log("That will be 200 yen.");\n} else {\n  console.log("Currently out of stock.");\n}' }, { code: 'let order = "Orange juice";\nif (order == "Apple juice") {\n  console.log("That will be 250 yen.");\n} else if (order == "Orange juice") {\n  console.log("That will be 200 yen.");\n} else {\n  console.log("Currently out of stock.");\n}' }, { code: 'let order = "Orange juice";\nif (order > "Apple juice") {\n  console.log("That will be 250 yen.");\n} else (order > "Orange juice") {\n  console.log("That will be 200 yen.");\n} else {\n  console.log("Currently out of stock.");\n}' }, { code: 'let order = "Orange juice";\nif (order == "Apple juice") {\n  console.log("That will be 250 yen.");\n} else (order == "Orange juice") {\n  console.log("That will be 200 yen.");\n} else {\n  console.log("Currently out of stock.");\n}' }], correctAnswer: 1 },

            // Old Q11 -> New Q19
            { id: 19, title: "ุงูุณุคุงู 19", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'Fuel is full.'", targetOutput: "Fuel is full.", options: [{ code: 'let fuel 100;\nif (fuel == 100) {\n  console.log("Fuel is full.");\n}' }, { code: 'let fuel 100;\nif (fuel > 100) {\n  console.log("Fuel is full.");\n}' }, { code: 'let fuel = 100;\nif (fuel > 100) {\n  console.log("Fuel is full.");\n}' }, { code: 'let fuel = 100;\nif (fuel == 100) {\n  console.log("Fuel is full.");\n}' }], correctAnswer: 3 },

            // Old Q20 -> New Q20 (Keep one same)
            { id: 20, title: "ุงูุณุคุงู 20", text: "ุญุฏุฏ ุงูุจุฑูุงูุฌ ุงูุฐู ูุทุจุน ุงูุนุจุงุฑุฉ 'Discounts are available.'", targetOutput: "Discounts are available.", options: [{ code: 'if (visitNumber > 3) {\n  console.log("Discounts are available.");\n} else {\n  console.log("Regular price.");\n}\nlet visitNumber = 5;' }, { code: 'let visitNumber = 5;\nif (visitNumber > 3) {\n  console.log("Discounts are available.");\n} else {\n  console.log("Regular price.");\n}' }, { code: 'if (visitNumber < 3) {\n  console.log("Discounts are available.");\n} else {\n  console.log("Regular price.");\n}\nlet visitNumber = 5;' }, { code: 'let visitNumber = 5;\nif (visitNumber < 3) {\n  console.log("Discounts are available.");\n} else {\n  console.log("Regular price.");\n}' }], correctAnswer: 1 }
        ];

        let currentQIndex = 0;
        let selectedAnswers = {};
        let timerTime = 40 * 60;

        // --- 3. ููุทู ุงูุญูุธ ุงูุชููุงุฆู ---
        const STORAGE_KEY = 'exam_state_final_v21_shuffled';

        function saveState() {
            const state = {
                currentQIndex,
                selectedAnswers,
                timerTime
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const state = JSON.parse(saved);
                currentQIndex = state.currentQIndex || 0;
                selectedAnswers = state.selectedAnswers || {};
                timerTime = (state.timerTime !== undefined) ? state.timerTime : 40 * 60;
            }
        }

        function clearState() {
            localStorage.removeItem(STORAGE_KEY);
        }

        window.onload = function() {
            loadState(); 
            loadQuestion(currentQIndex);
            startTimer();
            updateNavButtons();
        };

        function loadQuestion(index) {
            currentQIndex = index;
            saveState(); 
            const q = questions[index];
            document.getElementById('q-title').innerText = q.title;
            document.getElementById('q-text').innerText = q.text;
            document.getElementById('q-output').innerText = q.targetOutput;
            document.getElementById('q-counter').innerText = `${index + 1} / ${questions.length}`;

            const container = document.getElementById('options-container');
            container.innerHTML = ''; 

            q.options.forEach((opt, i) => {
                const card = document.createElement('div');
                const isSelected = selectedAnswers[index] === i ? 'selected' : '';
                card.className = `option-card ${isSelected}`;
                card.onclick = () => selectOption(i, card);
                card.innerHTML = `
                    <div class="opt-number-strip">
                        <span>${i + 1}</span>
                        <div class="radio-check"></div>
                    </div>
                    <div class="opt-code">
                        <pre>${opt.code}</pre>
                    </div>
                `;
                container.appendChild(card);
            });
            updateNavButtons();
            window.scrollTo(0, 0);
        }

        function selectOption(optionIndex, cardElement) {
            const allCards = document.querySelectorAll('.option-card');
            allCards.forEach(c => c.classList.remove('selected'));
            cardElement.classList.add('selected');
            selectedAnswers[currentQIndex] = optionIndex;
            saveState(); 
        }

        function nextQuestion() {
            if (currentQIndex < questions.length - 1) {
                currentQIndex++;
                loadQuestion(currentQIndex);
            }
        }

        function prevQuestion() {
            if (currentQIndex > 0) {
                currentQIndex--;
                loadQuestion(currentQIndex);
            }
        }

        function updateNavButtons() {
            document.getElementById('btn-prev').disabled = (currentQIndex === 0);
            if (currentQIndex === questions.length - 1) {
                document.getElementById('btn-next').disabled = true;
                document.getElementById('btn-next').style.opacity = '0.5';
            } else {
                document.getElementById('btn-next').disabled = false;
                document.getElementById('btn-next').style.opacity = '1';
            }
        }

        function startTimer() {
            const timerEl = document.getElementById('timer');
            const interval = setInterval(() => {
                let m = Math.floor(timerTime / 60);
                let s = timerTime % 60;
                let mStr = m < 10 ? '0' + m : m;
                let sStr = s < 10 ? '0' + s : s;
                timerEl.innerText = `${mStr}:${sStr}`;
                
                if (timerTime > 0) {
                    timerTime--;
                    if(timerTime % 5 === 0) saveState(); 
                } else {
                    clearInterval(interval);
                    showConfirmModal();
                }
            }, 1000);
        }

        function toggleQuestionList() {
            const modal = document.getElementById('questionListModal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                renderQuestionList();
                modal.style.display = 'flex';
            }
        }

        function renderQuestionList() {
            const container = document.getElementById('listItemsContainer');
            container.innerHTML = ''; 

            questions.forEach((q, index) => {
                const isAnswered = selectedAnswers[index] !== undefined;
                const statusText = isAnswered ? 'ุชูุช ุงูุฅุฌุงุจุฉ' : 'ูู ูุชู ุงูุฑุฏ';
                const statusClass = isAnswered ? 'status-answered' : 'status-unanswered';

                const item = document.createElement('div');
                item.className = 'list-item';
                item.onclick = () => { loadQuestion(index); toggleQuestionList(); };

                item.innerHTML = `
                    <span class="item-status ${statusClass}">${statusText}</span>
                    <span class="item-q-name">${q.title}</span>
                `;
                container.appendChild(item);
            });
        }

        function showConfirmModal() {
            document.getElementById('questionListModal').style.display = 'none';
            document.getElementById('confirmModal').style.display = 'flex';
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        function finalizeExam() {
            document.getElementById('confirmModal').style.display = 'none';
            
            let score = 0;
            let wrongQs = []; 

            questions.forEach((q, i) => {
                if (selectedAnswers[i] === q.correctAnswer) {
                    score++;
                } else {
                    wrongQs.push(i + 1); 
                }
            });

            const scoreDiv = document.getElementById('finalScoreDisplay');
            scoreDiv.style.display = 'block';
            scoreDiv.innerHTML = `ุงููุชูุฌุฉ ุงูููุงุฆูุฉ: ${score} ูู ${questions.length} (${Math.round((score/questions.length)*100)}%)`;

            const wrongDiv = document.getElementById('wrongQuestionsDisplay');
            if (wrongQs.length > 0) {
                wrongDiv.style.display = 'block';
                wrongDiv.style.backgroundColor = '#ffebee';
                wrongDiv.style.borderColor = '#ffcdd2';
                wrongDiv.style.color = '#c62828';
                wrongDiv.innerHTML = `<strong>ุฃุฑูุงู ุงูุฃุณุฆูุฉ ุงูุฎุทุฃ (ุฃู ุบูุฑ ุงููุฌุงุจุฉ):</strong><br> ${wrongQs.join(' - ')}`;
            } else {
                wrongDiv.style.display = 'block';
                wrongDiv.style.backgroundColor = '#e8f5e9';
                wrongDiv.style.borderColor = '#c8e6c9';
                wrongDiv.style.color = '#2e7d32';
                wrongDiv.innerHTML = `<strong>ุฃุญุณูุช! ุฌููุน ุงูุฅุฌุงุจุงุช ุตุญูุญุฉ.</strong>`;
            }

            document.getElementById('successModal').style.display = 'flex';
        }

        function closeSuccessModal() {
            clearState(); 
            sessionStorage.removeItem("access"); 
            window.location.replace("dashboard.html"); 
        }
    </script>
</body>
</html>
